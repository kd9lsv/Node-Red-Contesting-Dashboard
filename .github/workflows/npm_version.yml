on:
  push:
    branches:
      - master
    paths-ignore:
      - '.github/**/*.yml'
      - '.gitignore'

jobs:

  Create-Version-Tag:
    runs-on: ubuntu-latest
    steps:
    - run: echo "previous_tag=$(git describe --tags --abbrev=0 2>/dev/null || echo '')" >> $GITHUB_ENV
    - name: Create Tag
      id: create_tag
      uses: jaywcjlove/create-tag-action@main
      if: env.previous_tag
      with:
        package-path: ./package.json
        prerelease: false
        token: ${{ secrets.GITHUB_TOKEN }}
    - name: Display new version
      run: echo "version - ${{ steps.create_tag.outputs.version }}"
    - name: Generate Changelog
      id: changelog
      uses: jaywcjlove/changelog-generator@main
      if: steps.create_tag.outputs.successful
      with:
        head-ref: ${{steps.create_tag.outputs.version}}
        filter-author: (jaywcjlove|小弟调调™|dependabot\[bot\]|Renovate Bot)
        filter: (^[\s]+?[R|r]elease)|(^[R|r]elease)
    - name: Create Release
      uses: ncipollo/release-action@v1
      if: steps.create_tag.outputs.successful
      with:
        allowUpdates: true
        token: ${{ secrets.GITHUB_TOKEN }}
        name: ${{ steps.create_tag.outputs.version }}
        tag: ${{ steps.create_tag.outputs.version }}
        body: |
          ```bash
          See docker package for updated version ${{steps.create_tag.outputs.versionNumber}}
          ```
          ${{ steps.changelog.outputs.compareurl }}
          ${{ steps.changelog.outputs.changelog }}
